<?php
$pols[2] = '19.023932218551636,50.26831788408516,0 19.024270176887512,50.27029803228312,0 19.02429699897766,50.27046089795065,0 19.0242862701416,50.27046432669557,0 19.02435064315796,50.27087577429214,0 19.024436473846436,50.27147236699234,0 19.024436473846436,50.27178780378988,0 19.024479389190674,50.271986665044814,0 19.024520963430405,50.27235952765933,0 19.024353995919228,50.2730259587373,0 19.02398318052292,50.27375409366969,0 19.02350440621376,50.274675496251454,0 19.0230792760849,50.27557631074619,0 19.020745754241943,50.275188902605144,0 19.01880383491516,50.27562087962215,0 19.016754627227783,50.272192382710436,0 19.017683384008706,50.272000995666225,0 19.017153019085526,50.27101415489194,0 19.017647970467806,50.27091252581858,0 19.018153650686145,50.27167835474375,0 19.01851985603571,50.271635014352015,0 19.01895470917225,50.2712559315678,0 19.02104750275612,50.27074462575675,0 19.02083359658718,50.269907581006414,0 19.02046948671341,50.26824073378754,0 19.022648110985756,50.26773968242416,0 19.022820442914963,50.26873363631508,0 19.022907614707947,50.26917853004186,0 19.02342326939106,50.26920553212847,0 19.02376726269722,50.26915024212517,0 19.023629128932953,50.268415607616035,0';
$pols[3] = '19.019168615341187,50.26591759405949,0 19.01905596256256,50.26572899471703,0 19.018853455781937,50.26539637223842,0 19.020088613033295,50.26509118049798,0 19.022752046585083,50.26454937461293,0 19.02267962694168,50.26418030868903,0 19.023319333791733,50.26378316312696,0 19.02387522161007,50.265271745370015,0 19.023723006248474,50.265566970140064,0 19.02392953634262,50.268314455185646,0 19.023623764514923,50.26841817928515,0 19.023765921592712,50.26914638468062,0 19.02341991662979,50.26920756799943,0 19.022912979125977,50.269177887134816,0 19.02283787727356,50.26881046435814,0 19.02277149260044,50.268420576830756,0 19.02264878153801,50.26774437042909,0 19.0204319357872,50.26824871670603,0 19.019751995801926,50.266997444862874,0';
$pols[4] = '19.01206612586975,50.26751551488056,0 19.011666476726532,50.26714175708877,0 19.015730023384094,50.26623306765372,0 19.018878936767578,50.26540323045729,0 19.020423889160156,50.268235590429924,0 19.02104616165161,50.27075234038647,0 19.018927216529846,50.27125636015378,0 19.018516838550568,50.27163522864331,0 19.018172174692154,50.27169437299971,0 19.017666578292847,50.27091691885628,0 19.017130136489868,50.271012922700955,0 19.017666578292847,50.27198666504479,0 19.016754627227783,50.272185525469226,0 19.014882445335388,50.26991229558539,0';
$pols[5] = '19.023739099502563,50.26557468560859,0 19.023438692092896,50.26379838031417,0 19.0240341424942,50.263794951089295,0 19.02456521987915,50.26410700954142,0 19.026668071746826,50.263709220387284,0 19.026893377304077,50.263962982817574,0 19.027193784713745,50.26454594544213,0 19.028170108795166,50.26512890093135,0 19.029017686843872,50.26671999018637,0 19.02883529663086,50.26725491342707,0 19.028245210647583,50.267570378162745,0 19.027751684188843,50.26765610191461,0 19.028019905090332,50.268242448239945,0 19.03078258037567,50.26763895717659,0 19.031144678592682,50.268290452882546,0 19.030081182718277,50.26852704648544,0 19.030300453305244,50.2689745137814,0 19.0306032076478,50.26949312483126,0 19.03012636117637,50.2695987750675,0 19.030379075556993,50.27010902169169,0 19.02976246085018,50.27027499531809,0 19.029591092839837,50.27001580190601,0 19.02927488554269,50.2700720552468,0 19.029092642012984,50.269760732352864,0 19.027885721297935,50.270023382717284,0 19.0270462265471,50.27021299636089,0 19.02721656515496,50.27164328465543,0 19.024447202682495,50.2717329453665,0 19.024445861577988,50.271479224336225,0 19.024401605129242,50.27111578374838,0 19.02430236339569,50.27044375422246,0 19.023985862731934,50.26853047536959,0 19.02384102344513,50.26693944660175,0';
$pols[7] = '90,20,0 19.030122756958008,50.269613990396586,0 19.030616283416748,50.269504268477746,0 19.031227827072144,50.27061519122713,0 19.03160333633423,50.27204838043783,0 19.031656980514526,50.272260955068134,0 19.031726717948914,50.274311222943425,0 19.031568467617035,50.276213984538096,0 19.033753126859665,50.27619855704719,0 19.033150300383568,50.2783369310262,0 19.029705338180065,50.27760286677778,0 19.02860512956977,50.27709184338977,0 19.02784044854343,50.2769666043263,0 19.0274473791942,50.27678056639248,0 19.024965602438897,50.276289863079576,0 19.024518647929654,50.276106219659795,0 19.023243744741194,50.275808696531925,0 19.023102044739062,50.27557832458265,0 19.024269262736198,50.27326344286733,0 19.02455671617645,50.27236448474367,0 19.024426857577055,50.27175728160087,0 19.027193784713745,50.27165751493116,0 19.027052633464336,50.27023781470447,0 19.02905724942684,50.269764429022814,0 19.029268473386765,50.27007944853806,0 19.029583632946014,50.270037446056456,0 19.029774069786072,50.270282602875234,0 19.030390977859497,50.27010087836133,0';

function distance($lat1, $lon1, $lat2, $lon2) {
    $theta = $lon1 - $lon2;
    // echo $theta;exit;
    $dist = sin(deg2rad($lat1)) * sin(deg2rad($lat2)) +  cos(deg2rad($lat1)) * cos(deg2rad($lat2)) * cos(deg2rad($theta));
    $dist = acos($dist);
    $dist = rad2deg($dist);
      $miles = $dist * 60 * 1.1515;
  $unit = strtoupper($unit);

  if ($unit == "K") {
    return ($miles * 1.609344);
  } else if ($unit == "N") {
      return ($miles * 0.8684);
    } else {
        return $miles;
      }
    // return $dist;
}


$polsArray = array();
foreach($pols as $k => $pol) {
    $points = explode(' ', $pol);
    foreach($points as $point) {
        list($lat, $lng, $zero) = explode(',', $point);
        $polsArray[$k][] = array(
            'lat' => substr($lat, 0, 10),
            'lng' => substr($lng, 0, 10),
        );
    }
}

function magness($polsArray, $distance) {
    $newPolsArray = $polsArray;
    foreach($polsArray as $key => $points) {
        foreach($points as $point) {
            foreach($polsArray as $key2 => $points2) {
                if($key2 == $key) {
                    continue;
                }
                foreach($points2 as $i => $point2) {
                    if(intval($point['lat']*100000000) == intval($point2['lat']*100000000) && intval($point['lng']*100000000) == intval($point2['lng']*100000000)) {                        
                        // echo $point['lat'] . ' == ' . $point2['lat'] . "\n";
                        continue;
                    }

                    $d = distance($point['lat'], $point['lng'], $point2['lat'], $point2['lng'], 'K');
                    if($d < $distance) {
                        // print_r($newPolsArray[$key2][$i]);
                        $newPolsArray[$key2][$i] = array(
                            'lat' => $point['lat'],
                            'lng' => $point['lng']
                        );
                        // print_r($newPolsArray[$key2][$i]);
                        // break 3;
                        // echo $distance . ': ' . $d . "\n";
                    }
                }
            }
        }
    }
    print_r($newPolsArray[$key2][$i]);
    return $newPolsArray;
}
echo '<pre>';
$org = $polsArray;
set_time_limit(0);
for($i = 0; $i < 1000; $i++) {
    $polsArray = magness($polsArray, 0.01);
}
for($i = 0; $i < 1000; $i++) {
    $polsArray = magness($polsArray, 0.02);
}
// $polsArray = magness($polsArray, 0.02);
// echo '----' . "\n";
// $polsArray = magness($polsArray, 0.03);
// echo '----' . "\n";
// $polsArray = magness($polsArray, 0.04);
// echo '----' . "\n";
// $polsArray = magness($polsArray, 0.05);
?>
<table><tr><td>
<pre>
<?php
print_r($org[2]);
?>
</pre>
</td><td>
<pre>
<?php
print_r($polsArray[2]);
?>
</pre>
</td></tr></table>
<?php
// print_r(array_diff($org[2], ));
foreach($polsArray as $k => $points) {
    echo 'var coords = [ ' . "\n";
    foreach($points as $point) {
        echo "\t" . 'new google.maps.LatLng(' . $point['lng'] . ',' . $point['lat'] . '),' . "\n";
    }

    echo ']'. "\n\n\n\n";
}



